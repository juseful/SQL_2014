-- 시간대별 접수인원
SELECT A.ORDDATE, A.MEDLOCATFG
     , CASE WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 7 THEN '01.7시 전'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 8 THEN '02.7시~8시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 9 THEN '03.8시~9시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 10 THEN '04.9시~10시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 11 THEN '05.10시~11시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 12 THEN '06.11시~12시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 13 THEN '07.12시~13시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 14 THEN '08.13시~14시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 15 THEN '09.14시~15시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 16 THEN '10.15시~16시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 17 THEN '11.16시~17시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 24 THEN '12.17시 이후'
       ELSE '13.알수없음' END GUBUN
     , COUNT(A.PATNO) CNT
  FROM SMRSV00T A
 WHERE A.ORDDATE BETWEEN TO_DATE('20140101','YYYYMMDD') AND TO_DATE('20140105','YYYYMMDD')
   AND A.CANCELTIME IS NULL
GROUP BY A.ORDDATE, A.MEDLOCATFG
     , CASE WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 7 THEN '01.7시 전'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 8 THEN '02.7시~8시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 9 THEN '03.8시~9시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 10 THEN '04.9시~10시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 11 THEN '05.10시~11시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 12 THEN '06.11시~12시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 13 THEN '07.12시~13시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 14 THEN '08.13시~14시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 15 THEN '09.14시~15시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 16 THEN '10.15시~16시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 17 THEN '11.16시~17시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.CALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.CALLTIME,'HH24'),'24')) < 24 THEN '12.17시 이후'
       ELSE '13.알수없음' END
 ORDER BY 1,2,3

-- 시간대별 귀가안내인원
SELECT A.ORDDATE, A.MEDLOCATFG
     , CASE WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 7 THEN '01.7시 전'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 8 THEN '02.7시~8시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 9 THEN '03.8시~9시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 10 THEN '04.9시~10시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 11 THEN '05.10시~11시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 12 THEN '06.11시~12시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 13 THEN '07.12시~13시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 14 THEN '08.13시~14시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 15 THEN '09.14시~15시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 16 THEN '10.15시~16시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 17 THEN '11.16시~17시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 24 THEN '12.17시 이후'
       ELSE '13.알수없음' END GUBUN
     , COUNT(A.PATNO) CNT
  FROM SMRSV00T A
 WHERE A.ORDDATE BETWEEN TO_DATE('20140101','YYYYMMDD') AND TO_DATE('20140105','YYYYMMDD')
   AND A.CANCELTIME IS NULL
GROUP BY A.ORDDATE, A.MEDLOCATFG
     , CASE WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 7 THEN '01.7시 전'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 8 THEN '02.7시~8시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 9 THEN '03.8시~9시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 10 THEN '04.9시~10시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 11 THEN '05.10시~11시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 12 THEN '06.11시~12시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 13 THEN '07.12시~13시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 14 THEN '08.13시~14시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 15 THEN '09.14시~15시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 16 THEN '10.15시~16시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 17 THEN '11.16시~17시'
            WHEN DECODE(SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),1,1),'0',SUBSTR(NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24'),-1),NVL(TO_CHAR(A.ENDCALLTIME,'HH24'),'24')) < 24 THEN '12.17시 이후'
       ELSE '13.알수없음' END
 ORDER BY 1,2,3
